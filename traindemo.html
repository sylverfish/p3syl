<!DOCTYPE html>
<html lang="en">
  <head>      
    <meta charset="utf-8">      
    <title>Destinations</title>

   	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    

	<script type="text/javascript" src="d3/d3.js"></script>
   	<link type="text/css" rel="stylesheet" href="cal/cal-heatmap.css"/>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,800,600,700' rel='stylesheet' type='text/css'>
   	<link href='http://fonts.googleapis.com/css?family=Playfair+Display' rel='stylesheet' type='text/css'>
   	<link href='http://fonts.googleapis.com/css?family=Lora' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="mystyle.css">
	

	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
	  <script src="//code.jquery.com/jquery-1.10.2.js"></script>
	  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	  <!-- <link rel="stylesheet" href="/resources/demos/style.css"> -->
	  
	<!-- http://jqueryui.com/datepicker/ -->

    <style type="text/css">
	    body{
			padding-top:20px;
		    font-family: 'Open Sans', sans-serif;
		    font-size: 12px;
		    color: #111;
		    /*background-color: #400000; 
*/		    background-color: #FFF; 		    
		}

		.shadow { 
			cursor:crosshair; 
/*            -moz-box-shadow: -50px -50px 5px #888;
            -webkit-box-shadow: -50px -50px 5px #888;*/
            box-shadow: 5px -10px 5px #EEE; 
        }   
            /*http://stackoverflow.com/questions/6088409/svg-drop-shadow-using-css3*/

		.cal-heatmap-container .subdomain-text {
			font-size: 8px;
			fill: #444;
			pointer-events: none
		}

		.cal-heatmap-container .q1
		{
			background-color: #ddd;
			fill: #eee
		}

		/* unvisited link */
		a:link {
		    color: gray;
		}

		/* visited link */
		a:visited {
		    color: gray;
		}

		/* mouse over link */
		a:hover {
		    color:gray;
		}

		/* selected link */
		a:active {
		    color: gray;
		}

		

    </style>

    <script src="javascripts/prototype.js" type="text/javascript"></script>
	<script src="javascripts/scriptaculous.js" type="text/javascript"></script>

     <script type="text/javascript" src="cal/cal-heatmap.js"></script>

<script>
	 	( function($) {
	        // we can now rely on $ within the safety of our "bodyguard" function
	        $(document).ready( function() { 
	        	$( "#datepicker1" ).datepicker();
	        	$( "#datepicker2" ).datepicker();
	        } );
	    } ) ( jQuery );

		
	</script>	
        
  </head>
  <!--onClick="changeThePage(event)" -->
<body onkeydown="checkKey(event)"  style="padding:0; margin:0" onLoad="drawTheSvg()">
	<!-- style="background-image: url(images/bg.jpg);padding:0; margin:0" -->
	<!--style="background-image: url(images/bg.jpg)"-->
	<script type="text/javascript">

	var yScale = d3.scale.linear()
    .range([1, 65]);

    var dScale = d3.scale.linear()
    .range([1, 40]);

    var legendHidden=false;
    function toggleLegend(){
    	if(legendHidden){
    		legendHidden = false;
    		Effect.Appear('stationlegend');
    		document.getElementById("showhidelegend").innerHTML = "Hide legend";
    	}else{
    		legendHidden = true;
    		Effect.Fade('stationlegend');
    		document.getElementById("showhidelegend").innerHTML = "Show legend";
    	}
    }

    function showTrain(){
    	document.getElementById('snippet2').style="display: block";
    	document.getElementById('train').style="display: block";
    }
	function skip(){
		var n = pages-page;
		page=pages;
		hideLogo();
		Effect.Appear('snippet', {duration: 0.8} );
		Effect.Appear('finalmenu');
		Effect.Appear('selyears');
		Effect.Appear('bgformenu');
		
		
		// Effect.DropOut('selyears');
		l=l-speed*n;
		x=l;
		lx = lx-speed*n;
		if(x<=-pages*speed*n) {x=-pages*speed*n; l=-pages*speed*n;}
		cx=l;
		if(cx<=-pages*speed*n) {x=-pages*speed*n; l=-pages*speed*n;}
	    update();
	}

	var showDeathsOnly=false;
	function showDeaths(){
		showDeathsOnly = !showDeathsOnly;
		console.log("showDeaths"+ showDeathsOnly)
		updateData('3');
	}

	function skipToStart(){
		
		var n = page;

		page = 1;
		Effect.Appear('snippet', {duration: 0.8} );
		// Effect.Appear('selyears');
		Effect.DropOut('finalmenu');

		if(x>=0) {
	    		l=0;
	    		lx=0;
	    		cx=0;
	    		showLogo();
	    		Effect.Shake('chart',{duration:0.1, distance:5}); 
	    		return;
	    	}
    	
    	l=l+speed*n;
		x=l;
		lx = lx+speed*n;
		cx=l;
		// console.log("L:"+x);
		if(x>=0) {
    		l=0;
    		lx=0;
    		cx=0;
    		showLogo();
	    }
		update();
	}
	function changeThePage(e){
		var x = e.pageX;

		
		if(x<=clipWidth/10){
			moveLeft();
		}
		if(x>=7*clipWidth/10){
			moveRight();
		};
   	}

    function hideLogo(){
    	//document.getElementById("title").style.display = "none";
    	//document.getElementById("title").style.display = "none";
    	// Effect.Fade('id_of_element', { duration: 3.0 });
    	if(!hidden){
    		Effect.Fade('title',{ duration: 1.0, from: 1, to: 0 });
    		Effect.Fade('stationlegend',{ duration: 1.0, from: 1, to: 0 });
    		hidden=true;
    		legendHidden = true;
    		document.getElementById("showhidelegend").innerHTML = "Show legend";
    	}

    }

    var hidden = false;

    function showLogo(){
    	//document.getElementById("title").style.display = "block";
    	Effect.Appear('title', { duration: 1.0 });
    	Effect.Appear('stationlegend', { duration: 1.0 });
    	// Effect.Appear('selyears')
    	// document.getElementById("selyears").style.display = "block";
    	hidden = false;
    	legendHidden = false;
    	document.getElementById("showhidelegend").innerHTML = "Hide legend";
    }

    function hidePopup(){
    	popped = false;	
    	Effect.Fade('popme',{ duration: 0.2, from: 1, to: 0 });
    		
    }

    
    var count=3;
    var pageCt = 4;
    var xes = [-4,-90,30,-50];
    i=-1;
    j=-1;
    var snippets = [
    				"The Mumbai Suburban railway transports more than 7 million commuters daily",
    				"",
    				"But too many die! over 3000 a year! Why?","",
    				"Most cases are due to trespassing or crossing the tracks. This can be prevented!","",
    				"The railway is doing its bit in putting infrastructure to prevent crossing and making commute easier.","",
    				"It's time you did your bit.","",
    				"The little comfort of a short cut is not worth the risk.","",
    				"Travel safe","", ".","",".","",".",""];
    var xco = [530,530,20,20,40,40,40,40,40,530,530,20,20,40,40,40,40,40,40,40,40,40];
    var yco = [530,530,300,300,200,200,530,530, 530,530,300,300,200,200,530,530,200,200,530,530];
    var playing=false;
    function moveTrain(obj, mouseC){
    	if((mouseC && !playing) || (!mouseC)){
    		playing=true;
	    	new Effect.Move(obj, { x: 220, y: 0 }); 
	    	setTimeout(function(){ 
	    		count--; 
	    		if(count!=0) 
	    			moveTrain(obj, false); 
	    		var snippet = document.getElementById('snippet2');

	    		if(j<20){
	    				j++;
	    			}
	    		
	    		if(count%2==0){
	    			snippet.innerHTML=snippets[j];
	    			snippet.style = "position: absolute; top:"+yco[j]+"px; left:"+xco[j]+"px; padding:5px; display: block; color:#99A6B0; font-weight: 800; font-size:20px; background-color: yellow";

	    			

	    			Effect.Appear("snippet2");

	    		}	  
	    		else{
	    			Effect.Fade("snippet2");
	    		}


	    		if(count==0 && pageCt!=0 ){
	    			if(i<3)
	    				i++;
	    			var train = document.getElementById('train');
	    			train.style="position: absolute; top: 383px; left: "+xes[i]+"px; cursor: pointer";
	    			console.log("xes="+xes[i]+"i="+i);
	    			pageCt--;
	    			moveRight();
	    			count=4;
	    			moveTrain(obj, false); 
	    		}
	    	}
	    	, 2000);
    	}
    	
    }
    
  //   function showMonthlyTotals(){
  //   	inited = false;
  //   	var popme = document.getElementById('popme');               	
  //   	var st = document.getElementById('stationName');
  //   	domainV="year";
  //   	subDomainV="month";
  //   	leg = [0,10,15,20,25]
  //   	cellSizeV = 30;
  //   	rangeV = 1;
		// showCalendar();
  //   }
    </script>

    <div id="train" style="position: absolute; top:383px; left:520px; padding:5px; cursor:pointer; " onClick="moveTrain(this, true)">
    	<img src="images/train.svg" width="70px"/>
    </div>

	<div id="title" style="position: absolute; top:10px; left:20px;">
		<center style="font-family: 'Lora', serif; font-size: 12px">
		<img src="images/logo.png" width="160"/><br/>
		A visual representation of the tragic situation of <br/>accidents on the Mumbai Suburban Railway Network. <br/>(Thane to CST Mumbai, Andheri to Churchgate)</center>
		<!-- <svg width="320" height="325">
			<circle cx="150" cy="80" r="55" stroke="blue" stroke-width="27" fill="white"/>
  			 <rect width="160" height="40" x="70" y="60" style="fill:rgb(255,0,0)" />
  			 <text x="113" y="85" fill="white" >Destinations</text>
  			 <text x="32" y="170" fill="grey" style="font-family: 'Lora', serif; font-size: 12px">
  								  A visual representation of the tragic situation of 
		    <tspan x="20" y="190">accidents on the Mumbai Suburban Railway Network.</tspan>
		    <tspan x="31" y="210">(Thane to CST Mumbai, Andheri to Churchgate)</tspan>		    
		</svg> -->	
		<br/><br/><br/><br/><br/><br/><br/><br/>
		<span style="font-size: x-small; color: grey" >(Press arrow keys LEFT and RIGHT) Or click on the left or right of the page. <br/>Click on stations for more details.</style>
	</div>
	<div id="chart"  ></div>
	<!--<div><span id="left">Left</span> | <span id="right">Right</span></div>-->


	<div id="prev" onClick="moveLeft()" style="position: absolute; top:300px; left:10px;">
		<img src="images/prev.svg" alt="prev"/></div>
	<div id="next" onClick="moveRight()" style="position: absolute; top:300px; left:1200px;">
		<img src="images/next.svg" alt="next"/></div>



	<script>
var gender=[50,150];

	var clipWidth = window.innerWidth
	|| document.documentElement.clientWidth
	|| document.body.clientWidth;
	clipWidth = clipWidth;
	console.log(clipWidth);
	// var clipWidth = 1200;
	var clipHeight = 650;
	width = 100;
	var x=0;
	var cx=0;
	var lx=0;

	

	var prev=0;	
	var cprev=0;	

	var pad=20;	
	var l=0;
	var speed=1100-220+90;
	var pages=5;
	var update;
	var updatePie;
	var datasource = "data/2014Trains.csv";
	var svg=null;

	var something=false;
	function drawTheSvg(){

		if(svg!=null){
			console.log("removed svg to add new one")
			svg.remove()
		}
		
		d3.csv([datasource], function(error, data){
			svg= d3.select('#chart').append('svg')
		    .attr('width', clipWidth)
		    .attr('height', clipHeight);

		    svg.append("defs").append("clipPath")
		    .attr("id", "clip")
		    .append("rect")
		        .attr("width", clipWidth)
		        .attr("height", clipHeight);

		    var g = svg.append("g");

			

			var lines = g.selectAll("line")
			.data(data).enter();

			lines
		    .insert('line') //left
		    	.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "l1")
		    	.attr("x1", function(d){return lx+parseInt(d.inx1)})
		    	.attr("y1", function(d){return parseInt(d.iny1)})
		    	.attr("x2", function(d){return lx+parseInt(d.inx2)})
		    	.attr("y2", function(d){return parseInt(d.iny2)})
		    	.attr("stroke",function(d){if(d.Line=="CR") return "lightblue"; else return "pink";})
		    	.attr("fill", "none")
		    	.attr("stroke-width", "6")
		    	.attr("stroke-opacity","0.7")
		    	// .style("stroke-dasharray", ("2,4,2,4,2,4"));
		    	// .attr("style", "stroke:rgb(255,0,0);stroke-width:2");
		        // .style("stroke-dasharray", ("3, 3"));  //function(d){return d.Deaths}
		    ;

		   //  svg
		   //  .on("click", function(d){
		   //  	console.log(";;;;;;;;;;;;;;;;;;;;")
		   //  	var coordinates = [0, 0];
					// coordinates = d3.mouse(this);
					// var x = coordinates[0];
					// var snippet = document.getElementById('snippet')
					// 	snippet.innerHTML = snippet.innerHTML+" "+x;
					// if(x<=clipWidth/2){
						
					// 	moveLeft();
					// }else{
					// 	moveRight()
					// };
		   //  });

			var popped = false;

			var rects = g.selectAll("rect")
			.data(data).enter();
			
			rects
		    .insert('rect') //rect
		    	.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "stationsrect")
		    	.attr("width",120)
		    	.attr("height", 20)
		    	.attr("rx", 6)
    			.attr("ry", 6)
		    	.attr("x", function(d){ return lx+parseInt(d.rX)-10})
				.attr("y", function(d){return parseInt(d.rY)})
				.attr("fill", function(d){
					if(d.Type=="Interchange") return "#8AB66D";
					if(d.Type=="Slow") return "#99A6B0";
					if(d.Type=="Fast") return "#BC5C3D";
				})
				.attr("style","cursor:pointer")
				.on("click", function(d){
					if(!popped){
						var popme = document.getElementById('popme');               	
	                	var st = document.getElementById('stationName');
	                	st.innerHTML = d.Station + " " + year;

	                	if(!showDeathsOnly)
	                		dataV = "jsons/"+d.Station+"All"+year+".json";
	                	else
		                	dataV = "jsons/"+d.Station+"Deaths"+year+".json";

						showCalendar();
						popped = true;
						Effect.Appear('popme', {duration: 1.0} );
						
					}
					else{
						popped = false;	
						Effect.Fade('popme');
										
					}
				})
				.on("mouseover", function(d){
                	d3.select(this)
                	.style("fill-opacity", "1");
                	d3.select(this)
                	.append("title")
                	.text(d.Type + " Station");
                })
                .on("mouseout", function(d){
                	d3.select(this)
                })
		    ;

		    lines
		    .insert('line') //right
		    	.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "l2")
		    	.attr("x1", function(d){return lx+parseInt(d.outx1)})
		    	.attr("y1", function(d){return parseInt(d.outy1)})
		    	.attr("x2", function(d){return lx+parseInt(d.outx2)})
		    	.attr("y2", function(d){return parseInt(d.outy2)})
		    	.attr("stroke",function(d){
		    		return "lightgrey";
		    		// if(d.Line=="CR") return "lightblue"; else return "pink";
		    	})
		    	.attr("fill", "none")
		    	.attr("stroke-width", "6")
		    	.attr("stroke-opacity","0.7")
		    	// .style("stroke-dasharray", ("2,4,2,4,2,4"));
		    	;
		    	// .attr("style", "stroke:rgb(255,0,0);stroke-width:2");
		        // .style("stroke-dasharray", ("3, 3"));  //function(d){return d.Deaths}
		    ;

		    
		    var circles = g.selectAll("circle")
			.data(data).enter();

			circles
			.insert('circle')
				.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "cAll")
		    	.attr("cx", function(d){
		    		return lx+parseInt(d.rX)+40;
		    	})
		    	.attr("cy", function(d){
		    		if(d.Line == "CR")
		    			return parseInt(d.rY)-parseInt(d.All)/2-40-10;
		    		else
		    			return parseInt(d.rY)+parseInt(d.All)/2+40+30;
		    	})
		    	.attr("r", function(d){
		    		if(year=="2012to2014"){
		    			console.log("showBars1");
		    			return 0;
		    		}
		    		else
		    		{
			    		if(showDeathsOnly){
			    			return 0;
			    		}
			    		if(parseInt(d.All)==0) return 1; return parseInt(d.All)/2}
			    	}
		    	)
		    	.attr("fill", "lightblue")//#FFCC00
		    	.attr("fill-opacity","0.8")
		    	.attr("style","cursor:pointer")
		    	.on("mouseover", function(d){
                	d3.select(this)
                	.style("fill-opacity", "1");

                	d3.select(this)
                	.append("title")
                	.text(d.All + " accidents, and "+d.Deaths +" deaths at "+d.Station + " (Click for more details)");
				})
		    	.on("click", function(d){
                	d3.select(this)
                	.style("fill-opacity", "1");

                	d3.select(this)
                	.append("title")
                	.text(d.All + " accidents, and "+d.Deaths +" deaths at "+d.Station + " (Click for more details)");

                	var coordinates = [0, 0];
					coordinates = d3.mouse(this);
					var x = coordinates[0];
					var y = coordinates[1];
					
                	
                	
                	if(!popped){
                		var popme = document.getElementById('popme');               	
	                	var st = document.getElementById('stationName');
	                	st.innerHTML = d.Station + " " + year;
	                	if(!showDeathsOnly)
	                		dataV = "jsons/"+d.Station+"All"+year+".json";
	                	else
		                	dataV = "jsons/"+d.Station+"Deaths"+year+".json";
                		showCalendar();
                		popped = true;
						Effect.Appear('popme', {duration: 1.0} );
						
					}
					else{
						popped = false;
						Effect.Fade('popme');
						
					}


                	//http://stackoverflow.com/questions/16770763/mouse-position-in-d3
                	//http://stackoverflow.com/questions/14825864/jquery-show-a-hidden-div-at-mouse-position-when-a-link-is-clicked

                	gender= [d.Male, d.Female];
                	updatePie();

		    	
                })
                .on("mouseout", function(d){
                	d3.select(this)
                	.style("fill-opacity", "0.8");


                })
		    	;	

		    
		    circles
			.insert('circle')
				.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "cDeaths")
		    	.attr("cx", function(d){return lx+parseInt(d.rX)+40})
		    	.attr("cy", function(d){
	    			if(!showDeathsOnly){
		    			console.log(d.Line)
			    		if(d.Line == "CR"){
			    			yy = parseInt(d.rY)-d.Deaths/2-40-10
			    			return yy;
			    		}
			    		if(d.Line == "WR"){
			    			yy = parseInt(d.rY)+d.Deaths/2+40+30;
			    			console.log("WR----"+yy)
			    			return yy;
			    		}
		    		}
		    		else{
		    				if(d.Line == "CR")
			    			return parseInt(d.rY)-(d.Deaths*2)-40-10;
			    		else
			    			return parseInt(d.rY)+(d.Deaths*2)+40+30;
		    			
		    		}
		    	})
		    	.attr("r", function(d){
		    		if(year=="2012to2014"){
	    				return 0;
	    			}
	    			else
		    			{
			    		if(d.All==0) 
			    			return 1; 
			    		if(showDeathsOnly){
			    			return d.Deaths*2;
			    		}
			    		return d.Deaths/2;
			    	}
			    	
		    	})
		    	.attr("fill", "darkred")
		    	.attr("fill-opacity","0.8")
		    	.attr("style","cursor:pointer")
		    	.on("mouseover", function(d){
                	d3.select(this)
                	.style("fill-opacity", "1");
                	d3.select(this)
                	.append("title")
                	.text(d.All + " accidents, and "+d.Deaths +" deaths at "+d.Station);
                })
		    	.on("click", function(d){
                	d3.select(this)
                	.style("fill-opacity", "1");
                	d3.select(this)
                	.append("title")
                	.text(d.All + " accidents, and "+d.Deaths +" deaths at "+d.Station);
                	// document.getElementById('popme').style.display = "block";
                	if(!popped){
                		var popme = document.getElementById('popme');               	
	                	var st = document.getElementById('stationName');
	                	st.innerHTML = d.Station + " " + year;
	                	if(!showDeathsOnly)
	                		dataV = "jsons/"+d.Station+"All"+year+".json";
	                	else
		                	dataV = "jsons/"+d.Station+"Deaths"+year+".json";

                		showCalendar();
                		popped = true;
						Effect.Appear('popme', {duration: 1.0} );
						
					}
					else{
						popped = false;
						Effect.Fade('popme');
						
					}
                	// showCalendar();
                })
                .on("mouseout", function(d){
                	d3.select(this)
                	.style("fill-opacity", "0.8");

                	// document.getElementById('popme').style.display = "none";
                })
		    	;


		rects
		    .insert('rect')
		    .attr("class", "area").attr("clip-path", "url(#clip)")
	    	.attr("id", "bar12All")
	    	.attr("width", 20) 
	    	.attr("height", function (d){
	    		if(year=="2012to2014" && !showDeathsOnly){
	    			yScale.domain([0, d3.max(data, function(d) { return d.All12; })]);
		    		return yScale(d.All12);
		    	}
		    	else
	    			return 0;
	    	})
	    	.attr("x", function (d){return lx+parseInt(d.rX);})
			.attr("y", function (d) {
				if(year=="2012to2014"){
	            	if(d.Line=="CR")
		    			return parseInt(d.rY)-35-yScale(d.All12);
		    		else
		    			return parseInt(d.rY)+45;
		    	}		    			
            })
			.attr("fill", "#FFCC00")
	    	.attr("fill-opacity","0.6")
			.on("mouseover", function(d){
				d3.select(this)
            	.style("fill-opacity", "1");

            	d3.select(this)
            	.append("title")
            	.text(d.All12 + " accidents at "+d.Station + " in 2012"  + " (Click for more details)");
			})
			.on("mouseout", function(d){
            	d3.select(this)
            	.style("fill-opacity", "0.6");
            })
		;

		rects
		    .insert('rect')
		    .attr("class", "area").attr("clip-path", "url(#clip)")
	    	.attr("id", "bar12Deaths")
	    	.attr("width", 20) 
	    	.attr("height", function (d){
	    		if(year=="2012to2014" && !showDeathsOnly){
	    			yScale.domain([0, d3.max(data, function(d) { return d.All12; })]);
		    		return yScale(d.Deaths12)/2;
		    	}
		    	if(year=="2012to2014" && showDeathsOnly){
	    			dScale.domain([0, d3.max(data, function(d) { return d.Deaths12; })]);
		    		return dScale(d.Deaths12);
			    }
			    return 0;
	    	})
	    	.attr("x", function (d){return lx+parseInt(d.rX);})
			.attr("y", function (d) {
				if(year=="2012to2014"){
	            	if(d.Line=="CR"){
	            		if(!showDeathsOnly)
		    				return parseInt(d.rY)-35-yScale(d.Deaths12);
		    			else
		    				return parseInt(d.rY)-35-dScale(d.Deaths12);
		    		}
		    		else
		    			return parseInt(d.rY)+45;
		    	}		    			
            })
			.attr("fill", "darkred")
	    	.attr("fill-opacity","0.6")
			.on("mouseover", function(d){
				d3.select(this)
            	.style("fill-opacity", "1");

            	d3.select(this)
            	.append("title")
            	.text(d.Deaths12 + " deaths at "+d.Station + " in 2012");
			})
			.on("mouseout", function(d){
            	d3.select(this)
            	.style("fill-opacity", "0.6");
            })
		;

		rects
		    .insert('rect')
		    .attr("class", "area").attr("clip-path", "url(#clip)")
	    	.attr("id", "bar13All")
	    	.attr("width", 20) 
	    	.attr("height", function (d){
	    		if(year=="2012to2014" && !showDeathsOnly){
	    			yScale.domain([0, d3.max(data, function(d) { return d.All13; })]);
		    		return yScale(d.All13);
		    	}
		    	else
	    			return 0;
	    	})
	    	.attr("x", function (d){return lx+parseInt(d.rX)+22;})
			.attr("y", function (d) {
				if(year=="2012to2014"){
	            	if(d.Line=="CR")
		    			return parseInt(d.rY)-35-yScale(d.All13);
		    		else
		    			return parseInt(d.rY)+45;
		    	}		    			
            })
			.attr("fill", "#FFCC00")
	    	.attr("fill-opacity","0.6")
			.on("mouseover", function(d){
				d3.select(this)
            	.style("fill-opacity", "1");

            	d3.select(this)
            	.append("title")
            	.text(d.All13 + " accidents at "+d.Station+" in 2013"  + " (Click for more details)");
			})
			.on("mouseout", function(d){
            	d3.select(this)
            	.style("fill-opacity", "0.6");
            })
		;

		rects
		    .insert('rect')
		    .attr("class", "area").attr("clip-path", "url(#clip)")
	    	.attr("id", "bar13Deaths")
	    	.attr("width", 20) 
	    	.attr("height", function (d){
	    		if(year=="2012to2014" && !showDeathsOnly){
	    			yScale.domain([0, d3.max(data, function(d) { return d.All13; })]);
		    		return yScale(d.Deaths13);
		    	}
		    	if(year=="2012to2014" && showDeathsOnly){
	    			dScale.domain([0, d3.max(data, function(d) { return d.Deaths13; })]);
		    		return dScale(d.Deaths13);
			    }
	    		return 0;
	    	})
	    	.attr("x", function (d){return lx+parseInt(d.rX)+22;})
			.attr("y", function (d) {
				if(year=="2012to2014"){
	            	if(d.Line=="CR"){
	            		if(!showDeathsOnly)
	            			return parseInt(d.rY)-35-yScale(d.Deaths13);
	            		else
	            			return parseInt(d.rY)-35-dScale(d.Deaths13);
	            	}
		    		else
		    			return parseInt(d.rY)+45;
		    	}   			
            })
			.attr("fill", "darkred")
	    	.attr("fill-opacity","0.6")
			.on("mouseover", function(d){
				d3.select(this)
            	.style("fill-opacity", "1");

            	d3.select(this)
            	.append("title")
            	.text(d.Deaths13 + " deaths at "+d.Station + " in 2013");
			})
			.on("mouseout", function(d){
            	d3.select(this)
            	.style("fill-opacity", "0.6");
            })
		;

		
		rects
		    .insert('rect')
		    .attr("class", "area").attr("clip-path", "url(#clip)")
	    	.attr("id", "bar14All")
	    	.attr("width", 20) 
	    	.attr("height", function (d){
	    		yScale.domain([0, d3.max(data, function(d) { return d.All14; })]);
	    		if(year=="2012to2014" && !showDeathsOnly){
		    		return yScale(d.All14);
		    	}
		    	else
	    			return 0;
	    	})
	    	.attr("x", function (d){return lx+parseInt(d.rX)+44;})
			.attr("y", function (d) {
				if(year=="2012to2014"){
	            	if(d.Line=="CR")
		    			return parseInt(d.rY)-35-yScale(d.All14);
		    		else
		    			return parseInt(d.rY)+45;	
	    		}	    			
            })
			.attr("fill", "#FFCC00")
	    	.attr("fill-opacity","0.6")
			.on("mouseover", function(d){
				d3.select(this)
            	.style("fill-opacity", "1");

            	d3.select(this)
            	.append("title")
            	.text(d.All14 + " accidents at "+d.Station+" in 2014"  + " (Click for more details)");
			})
			.on("mouseout", function(d){
            	d3.select(this)
            	.style("fill-opacity", "0.6");
            })
		;

		rects
		    .insert('rect')
		    .attr("class", "area").attr("clip-path", "url(#clip)")
	    	.attr("id", "bar14Deaths")
	    	.attr("width", 20) 
	    	.attr("height", function (d){
	    		if(year=="2012to2014" && !showDeathsOnly){
	    			yScale.domain([0, d3.max(data, function(d) { return d.All14; })]);
		    		return yScale(d.Deaths14);
		    	}
		    	if(year=="2012to2014" && showDeathsOnly){
	    			dScale.domain([0, d3.max(data, function(d) { return d.Deaths14; })]);
		    		return dScale(d.Deaths14);
		    	}
    			return 0;
	    	})
	    	.attr("x", function (d){return lx+parseInt(d.rX)+44;})
			.attr("y", function (d) {
				if(year=="2012to2014"){
	            	if(d.Line=="CR"){
	            		if(!showDeathsOnly)
	            			return parseInt(d.rY)-35-yScale(d.Deaths14);
	            		else
	            			return parseInt(d.rY)-35-dScale(d.Deaths14);
		    		}
		    		else
		    			return parseInt(d.rY)+45;		
		    	}    			
            })
			.attr("fill", "darkred")
	    	.attr("fill-opacity","0.6")
			.on("mouseover", function(d){
				d3.select(this)
            	.style("fill-opacity", "1");

            	d3.select(this)
            	.append("title")
            	.text(d.Deaths14 + " deaths at "+d.Station + "in 2014");
			})
			.on("mouseout", function(d){
            	d3.select(this)
            	.style("fill-opacity", "0.6");
            })
		;


			


	   	
			rects
		    .insert('rect') //gender
		    	.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "gender1")
		    	// .attr("width", function(d){return d.Male/2})
		    	.attr("width", function(d){
		    		if(year=="2012to2014"){
		    			return 0;
		    		}
		    		else
		    		{
			    		m=parseInt(d.Male);
			    		f=parseInt(d.Female);
			    		if((m+f)>0){
			    			t = m/(m+f)*80;
			    		}else t=0;
			    		t = Math.round(t);
			    		// console.log("M:"+t)
			    		return t;
		    		}
		    	})
		    	.attr("height", 10 )
		    	.attr("x", function(d){return lx+parseInt(d.rX);})
				.attr("y", function (d) {
                	if(d.Line=="CR")
		    			return parseInt(d.rY)-35;
		    		else
		    			return parseInt(d.rY)+45		    			
                })
				.attr("fill", "#31A2FD")
				.on("mouseover", function(d){
					var total = parseInt(d.Male) + parseInt(d.Female);
					var m = Math.round(d.Male/total*100);
					var f = Math.round(d.Female/total*100);
                	d3.select(this)
                	.append("title")
                	.text(m + "% male, and "+ f +"% female");
                })
		    ;

		    var imgs = g.selectAll("img")
			.data(data).enter();


            imgs.insert("svg:image")
                .attr("id","maleicon")
                .attr("xlink:href", "images/male.svg")
                .attr("x", function(d){return lx+parseInt(d.rX)-20;})
				.attr("y", function(d){
					// return 100;
					if(d.Line=="CR")
		    			return parseInt(d.rY)-35-8;
		    		else
		    			return parseInt(d.rY)+35+8;
		    	})
		    	.attr("width", function(d){
		    		if(parseInt(d.Male)+parseInt(d.Female)<=0 || year=="2012to2014") 
		    			{console.log("0000"); return 0;}
		    		return 15;
		    	})
		    	.attr("height",function(d){
		    		if(parseInt(d.Male)+parseInt(d.Female)<=0 || year=="2012to2014") {return 0;}
		    		return 15;
		    	})
		    	.on("mouseover", function(d){
                	d3.select(this)
                	.append("title")
                	.text(d.Male + " males involved in accidents");
				})
		    	;

            imgs.insert("svg:image")
                .attr("id","femaleicon")
                .attr("xlink:href", "images/female.svg")
                .attr("x", function(d){return lx+parseInt(d.rX)+85;})
				.attr("y", function(d){
					// return 100;
					if(d.Line=="CR")
		    			return parseInt(d.rY)-35-8;
		    		else
		    			return parseInt(d.rY)+35+8;
		    	})
		    	.attr("width",function(d){
		    		if(parseInt(d.Male)+parseInt(d.Female)<=0 || year=="2012to2014") { return 0;}
		    		return 15
		    	})
		    	.attr("height",function(d){
		    		if(parseInt(d.Male)+parseInt(d.Female)<=0 || year=="2012to2014") {return 0;}
		    		return 15
		    	})
		    	.on("mouseover", function(d){
                	d3.select(this)
                	.append("title")
                	.text(d.Female + " females involved in accidents");
				})
                ;


            imgs.insert("svg:image")
                // .append()
                .attr("id","dayicon")
                .attr("xlink:href", "images/sun.svg")
                .attr("x", function(d){return lx+parseInt(d.rX)-20;})
				.attr("y", function(d){
					if(d.Line=="CR")
		    			return parseInt(d.rY)-35+10;
		    		else
		    			return parseInt(d.rY)+35-10;
		    	})
		    	.attr("width",function(d){
		    		if(parseInt(d.Day)+parseInt(d.Night)<=0 || year=="2012to2014") { return 0;}
		    		return 15
		    	})
		    	.attr("height",function(d){
		    		if(parseInt(d.Day)+parseInt(d.Night)<=0 || year=="2012to2014") { return 0;}
		    		return 15
		    	})
		    	.on("mouseover", function(d){
                	d3.select(this)
                	.append("title")
                	.text(d.Day +" accidents at daytime");
				})
		    	;

            imgs.insert("svg:image")
                .attr("id","nighticon")
                .attr("xlink:href", "images/moon.svg")
                .attr("x", function(d){return lx+parseInt(d.rX)+85;})
				.attr("y", function(d){if(d.Line=="CR")
		    			return parseInt(d.rY)-35+10;
		    		else
		    			return parseInt(d.rY)+35-10;
		    	})
		    	.attr("width",function(d){
		    		if(parseInt(d.Day)+parseInt(d.Night)<=0 || year=="2012to2014") { return 0;}
		    		return 15
		    	})
		    	.attr("height",function(d){
		    		if(parseInt(d.Day)+parseInt(d.Night)<=0 || year=="2012to2014") { return 0;}
		    		return 15
		    	})
		    	.on("mouseover", function(d){
                	d3.select(this)
                	.append("title")
                	.text(d.Night + " accidents at nighttime");
				});

		    rects
		    .insert('rect') //gender
		    	.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "gender2")
		    	// .attr("width", function(d){return d.Female/2})
		    	.attr("width", function(d){
		    		if(year=="2012to2014"){
		    			return 0;
		    		}
		    		else
		    		{
			    		m=parseInt(d.Male);
			    		f=parseInt(d.Female);
			    		if((m+f)>0){
			    			t = f/(m+f)*80;
			    		}else t=0;
			    		t = Math.round(t);
			    		// t2=10-t
			    		// console.log("F:"+t)
			    		return t;
		    		}
		    	})


		    	.attr("height", 10 )
		    	.attr("x", function(d){
		    		m=parseInt(d.Male);
		    		f=parseInt(d.Female);
		    		if((m+f)>0){
		    			t = m/(m+f)*80;
		    		}else t=0;

		    		return lx+t+parseInt(d.rX);
		    	})
				.attr("y", function(d){
					if(d.Line=="CR")
		    			return parseInt(d.rY)-35;
		    		else
		    			return parseInt(d.rY)+45
		    	})
				.attr("fill", "#491B65")
				.on("mouseover", function(d){
					var total = parseInt(d.Male) + parseInt(d.Female);
					var m = Math.round(d.Male/total*100);
					var f = Math.round(d.Female/total*100);
                	d3.select(this)
                	.append("title")
                	.text(m + "% male, and "+ f +"% female");
                })
		    ;

		  

		    rects
		    .insert('rect') //day
		    	.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "day")
		    	.attr("width", function(d){
		    		if(year=="2012to2014"){
		    			return 0;
		    		}
		    		else
		    		{
			    		m=parseInt(d.Day);
			    		f=parseInt(d.Night);
			    		if((m+f)>0){
			    			t = m/(m+f)*80;
			    		}else t=0;
			    		t = Math.round(t);
			    		// t2=10-t
			    		// console.log("F:"+t)
			    		return t;
		    		}
		    	})
		    	.attr("height", 10 )
		    	.attr("x", function(d){return lx+parseInt(d.rX);})
				.attr("y", function(d){
					if(d.Line=="CR")
		    			return parseInt(d.rY)-20;
		    		else
		    			return parseInt(d.rY)+30;
		    	})
				// .attr("fill", "#CC9900")
				.attr("fill", "yellow")
				// .attr("stroke", "#666")
				// .attr("stroke-width","1")
				.on("mouseover", function(d){
					var total = parseInt(d.Day) + parseInt(d.Night);
					var m = Math.round(d.Day/total*100);
					var f = Math.round(d.Night/total*100);
                	d3.select(this)
                	.append("title")
                	.text(m + "% during daytime, and "+ f +"% during nights");
                })
		    ;

		    rects
		    .insert('rect') //night
		    	.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "night")
		    	.attr("width", function(d){
		    		if(year=="2012to2014"){
		    			return 0;
		    		}
		    		else
		    		{
			    		m=parseInt(d.Day);
			    		f=parseInt(d.Night);
			    		if((m+f)>0){
			    			t = f/(m+f)*80;
			    		}else t=0;
			    		t = Math.round(t);
			    		// t2=10-t
			    		// console.log("F:"+t)
			    		return t;
			    	}
			    })
		    	.attr("height", 10 )
		    	.attr("x", function(d){
		    		m=parseInt(d.Day);
		    		f=parseInt(d.Night);
		    		if((m+f)>0){
		    			t = m/(m+f)*80;
		    		}else t=0;

		    		return lx+t+parseInt(d.rX);
		    	})
				.attr("y", function(d){
					if(d.Line=="CR")
		    			return parseInt(d.rY)-20;
		    		else
		    			return parseInt(d.rY)+30;
		    	})
				// .attr("fill", "#AEAEAE")
				.attr("fill", "#666")
				// .attr("stroke", "#666")
				// .attr("stroke-width","1")
				.on("mouseover", function(d){
					var total = parseInt(d.Male) + parseInt(d.Female);
					var m = Math.round(d.Day/total*100);
					var f = Math.round(d.Night/total*100);
                	d3.select(this)
                	.append("title")
                	.text(m + "% during daytime, and "+ f +"% during nights");
                })
		    ;


			var imgs = g.selectAll("img")
			.data(data).enter();


            imgs.insert("svg:image")
                .attr("id","stationsymbol")
                .attr("xlink:href", "images/stationsymbol.svg")
                .attr("x", function(d){return lx+parseInt(d.rX)})
				.attr("y",  function(d){ return parseInt(d.rY)+3})
		    	.attr("width", 15)
		    	.attr("height",15)
		    	;


		    var text = g.selectAll("text")
				.data(data).enter();

			text
				.insert('text')
				.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "stations")
		    	.attr("x", function(d){return lx+parseInt(d.rX)+20})
		    	.attr("y", function(d){return parseInt(d.rY)+15})
		    	.text(function (d) {return d.Station;})
		    	.attr("font-family", "sans-serif")
                .attr("font-size", "11px")
                .attr("fill", "white")
                .style("fill-opacity", "0.7")
                .attr("style","cursor:pointer")
                .on("click", function(d){
					if(!popped){
						var popme = document.getElementById('popme');               	
	                	var st = document.getElementById('stationName');
	                	st.innerHTML = d.Station + " " + year;
	                	if(!showDeathsOnly)
	                		dataV = "jsons/"+d.Station+"All"+year+".json";
	                	else
		                	dataV = "jsons/"+d.Station+"Deaths"+year+".json";
						showCalendar();
						popped = true;
						Effect.Appear('popme', {duration: 1.0} );
						
					}
					else{
						popped = false;		
						Effect.Fade('popme');
									
					}
				})
		    	;

		   	text
				.insert('text')
				.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "figures")
		    	.attr("x", function(d){return lx+parseInt(d.rX)+60})
		    	// .attr("x", function(d){return lx+parseInt(d.rX)+30+d.All/2})
		    	// .attr("y", function(d){return lx+parseInt(d.rY)-d.All/2-25})
		    	// .attr("y", function(d){return lx+parseInt(d.rY)-d.All/2-25})
		    	.attr("y", function(d){
		    		if(d.Line=="CR")
		    			return parseInt(d.rY)-75;
	    			else
		    			return parseInt(d.rY)+115;
		    	})
		    	.text(function (d) {
		    		if(year=="2012to2014"){
		    			console.log("showBars1");
		    			return "";
		    		}
		    		else
			    		{
			    		if(d.All==0){
			    			if(!showDeathsOnly){
			    				return "No accidents";
			    			}
			    			else return "";
			    		}
			    		else{
			    			if(!showDeathsOnly){
			    				return d.All;
			    			}
			    		}
			    	}
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", function (d) {
                	if(d.All==0)
		    			return "Light"
		    		else
		    			return "Bold";
                	// var size=Math.round(d.All/2);
                	// if(size<9) size=9;
                	// return size;
                })
                .attr("font-size", function (d) {
                	if(d.All==0)
		    			return 10
		    		else
		    			return 35;
                	// var size=Math.round(d.All/2);
                	// if(size<9) size=9;
                	// return size;
                })
                .attr("fill", "grey")
                .style("fill-opacity", "0.7")
                .on("mouseover", function(d){
                	d3.select(this)
                	.style("fill-opacity", "1");

                	d3.select(this)
                	.append("title")
                	.text("accidents in a year");
                })
                .on("mouseout", function(d){
                	d3.select(this)
                	.style("fill-opacity", "0.7");
                })
		    	;

		    text
				.insert('text')
				.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "bar12AText")
		    	.attr("x", function (d){return lx+parseInt(d.rX);})
				.attr("y", function (d) {
					yScale.domain([0, d3.max(data, function(d) { return d.All12; })]);
		    		var ht =  yScale(d.All12);
					if(year=="2012to2014"){
		            	if(d.Line=="CR")
			    			return parseInt(d.rY)-40-yScale(d.All12);
			    		else
			    			return parseInt(d.rY)+60+yScale(d.All12);
			    	}		    			
	            })
		    	.text(function (d) {
		    		if(year!="2012to2014"){
		    			return "";
		    		}
		    		else
			    		{
			    		if(d.All12==0){
			    			if(!showDeathsOnly){
			    				return "0";
			    			}
			    			else return "";
			    		}
			    		else{
			    			if(!showDeathsOnly){
			    				return d.All12;
			    			}
			    		}
			    	}
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", "light")
                .attr("font-size", 12)
                .attr("fill", "grey")
                .style("fill-opacity", "0.7")
		    	;

		    text
				.insert('text')
				.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "bar12DText")
		    	.attr("x", function (d){return lx+parseInt(d.rX);})
				.attr("y", function (d) {
					dScale.domain([0, d3.max(data, function(d) { return d.Deaths12; })]);
		    		var ht =  yScale(d.All12);
					if(year=="2012to2014"){
		            	if(d.Line=="CR")
			    			return parseInt(d.rY)-40-yScale(d.Deaths12);
			    		else
			    			return parseInt(d.rY)+60+yScale(d.Deaths12);
			    	}		    			
	            })
		    	.text(function (d) {
		    		if(year!="2012to2014"){
		    			return "";
		    		}
		    		else
			    		{
			    		if(d.Deaths12==0){
			    			if(showDeathsOnly){
			    				return "0";
			    			}
			    			else return "";
			    		}
			    		else{
			    			if(showDeathsOnly){
			    				return d.Deaths12;
			    			}
			    		}
			    	}
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", "light")
                .attr("font-size", 12)
                .attr("fill", "darkred")
                .style("fill-opacity", "0.7")
		    	;

		    text
				.insert('text')
				.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "bar13AText")
		    	.attr("x", function (d){return lx+parseInt(d.rX)+22;})
				.attr("y", function (d) {
					yScale.domain([0, d3.max(data, function(d) { return d.All13; })]);
		    		var ht =  yScale(d.All13);
					if(year=="2012to2014"){
		            	if(d.Line=="CR")
			    			return parseInt(d.rY)-40-yScale(d.All13);
			    		else
			    			return parseInt(d.rY)+60+yScale(d.All13);
			    	}		    			
	            })
		    	.text(function (d) {
		    		if(year!="2012to2014"){
		    			return "";
		    		}
		    		else
			    		{
			    		if(d.All13==0){
			    			if(!showDeathsOnly){
			    				return "0";
			    			}
			    			else return "";
			    		}
			    		else{
			    			if(!showDeathsOnly){
			    				return d.All13;
			    			}
			    		}
			    	}
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", "light")
                .attr("font-size", 12)
                .attr("fill", "grey")
                .style("fill-opacity", "0.7")
		    	;

		    text
				.insert('text')
				.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "bar13DText")
		    	.attr("x", function (d){return lx+parseInt(d.rX)+22;})
				.attr("y", function (d) {
					dScale.domain([0, d3.max(data, function(d) { return d.Deaths13; })]);
		    		var ht =  yScale(d.Deaths13);
					if(year=="2012to2014"){
		            	if(d.Line=="CR")
			    			return parseInt(d.rY)-40-yScale(d.Deaths13);
			    		else
			    			return parseInt(d.rY)+60+yScale(d.Deaths13);
			    	}		    			
	            })
		    	.text(function (d) {
		    		if(year!="2012to2014"){
		    			return "";
		    		}
		    		else
			    		{
			    		if(d.Deaths13==0){
			    			if(showDeathsOnly){
			    				return "0";
			    			}
			    			else return "";
			    		}
			    		else{
			    			if(showDeathsOnly){
			    				return d.Deaths13;
			    			}
			    		}
			    	}
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", "light")
                .attr("font-size", 12)
                .attr("fill", "darkred")
                .style("fill-opacity", "0.7")
		    	;

		    text
				.insert('text')
				.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "bar14AText")
		    	.attr("x", function (d){return lx+parseInt(d.rX)+44;})
				.attr("y", function (d) {
					yScale.domain([0, d3.max(data, function(d) { return d.All14; })]);
		    		var ht =  yScale(d.All14);
					if(year=="2012to2014"){
		            	if(d.Line=="CR")
			    			return parseInt(d.rY)-40-yScale(d.All14);
			    		else
			    			return parseInt(d.rY)+60+yScale(d.All14);
			    	}		    			
	            })
		    	.text(function (d) {
		    		if(year!="2012to2014"){
		    			return "";
		    		}
		    		else
			    		{
			    		if(d.All14==0){
			    			if(!showDeathsOnly){
			    				return "0";
			    			}
			    			else return "";
			    		}
			    		else{
			    			if(!showDeathsOnly){
			    				return d.All14;
			    			}
			    		}
			    	}
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", "light")
                .attr("font-size", 12)
                .attr("fill", "grey")
                .style("fill-opacity", "0.7")
		    	;

		    text
				.insert('text')
				.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "bar14DText")
		    	.attr("x", function (d){return lx+parseInt(d.rX)+44;})
				.attr("y", function (d) {
					dScale.domain([0, d3.max(data, function(d) { return d.Deaths14; })]);
		    		var ht =  dScale(d.All14);
					if(year=="2012to2014"){
		            	if(d.Line=="CR")
			    			return parseInt(d.rY)-40-yScale(d.Deaths14);
			    		else
			    			return parseInt(d.rY)+60+yScale(d.Deaths14);
			    	}		    			
	            })
		    	.text(function (d) {
		    		if(year!="2012to2014"){
		    			return "";
		    		}
		    		else
			    		{
			    		if(d.Deaths14==0){
			    			if(showDeathsOnly){
			    				return "0";
			    			}
			    			else return "";
			    		}
			    		else{
			    			if(showDeathsOnly){
			    				return d.Deaths14;
			    			}
			    		}
			    	}
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", "light")
                .attr("font-size", 12)
                .attr("fill", "darkred")
                .style("fill-opacity", "0.7")
		    	;

		   	text
				.insert('text')
				.attr("class", "area").attr("clip-path", "url(#clip)")
		    	.attr("id", "figuresdeaths")
		    	// .attr("x", function(d){return lx+parseInt(d.rX)+d.All/2+30})
		    	// .attr("y", function(d){return lx+parseInt(d.rY)-25})
		    	.attr("x", function(d){return lx+parseInt(d.rX)+70})
		    	.attr("y", function(d){
		    		if(d.Line=="CR")
		    			return parseInt(d.rY)-55;
	    			else
		    			return parseInt(d.rY)+85;
		    	})
		    	.text(function (d) {
		    		if(year=="2012to2014"){
		    			console.log("showBars1");
		    			return "";
		    		}
		    		else
			    	{
			    		if(!showDeathsOnly){
			    			if(d.Deaths==0){
			    				return "";
				    		}
				    		else 
				    			return d.Deaths;
			    		}
			    		else{
			    			if(d.Deaths==0){
			    				return "No fatalities";
				    		}
				    		else 
				    			return d.Deaths;
			    		}
			    	}
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", function(d){
		    		if(!showDeathsOnly){
		    			return "light";
		    		}
		    		else{
		    			if(d.Deaths==0)
		    				return "light";
		    			else
		    				return "bold";
		    		}
		    	})
                .attr("font-size", function (d) {
                	if(!showDeathsOnly){
	            		return 10;
	            	}
	            	else{
	            		if(d.Deaths==0)
	            			return 16;
	            		return 25;
	            	}
                })
                .attr("fill", "darkred")
                .style("fill-opacity", "0.7")
                .on("mouseover", function(d){
                	d3.select(this)
                	.style("fill-opacity", "1");

                	d3.select(this)
                	.append("title")
                	.text("Deaths in a year");
                })
                .on("mouseout", function(d){
                	d3.select(this)
                	.style("fill-opacity", "0.7");
                })
		    	;


		    	//function(d){return lx+parseInt(d.rY)-d.Deaths/2-25}

		 //    circles
			// .insert('circle')
			// 	.attr("class", "area").attr("clip-path", "url(#clip)")
		 //    	.attr("id", "cDeaths")
		 //    	.attr("cx", function(d){function(d){if(d.All==0) return 1; return xScale(d.Deaths)})
		 //    	.attr("cy", 200)
		 //    	.attr("r", function(d){if(d.All==0) return 1; return xScale(d.Deaths)})
		 //    	.attr("fill", "red")
		    	;	    

		 //    g.selectAll("rect")
			// .data(data).enter()
		 //    .insert('rect') //rect
		 //    	.attr("class", "area").attr("clip-path", "url(#clip)")
		 //    ;

		 //    g.selectAll("circle")
			// .data(data).enter()
		 //    .insert('line') //circle
		 //    	.attr("class", "area").attr("clip-path", "url(#clip)")
		 //    ;

		 //    g.selectAll("line")
			// .data(data).enter()
		 //    .insert('line') //right
		 //    	.attr("class", "area").attr("clip-path", "url(#clip)")
		 //    ;

			// g.selectAll("rect")
		 //    // .data(data).enter().append('rect')
		 //    //     .attr("class", "area").attr("clip-path", "url(#clip)")
		 //    //     .attr('x', function(d){x=x+prev+pad; prev=parseInt(d.All); return x;})
		 //    //     // .attr('x', function(d){return xScale(d.x)})
		 //    //     .attr('width', function(d){if(d.All==0) return 1; return (d.All)})
		 //    //     .attr('height', function(d){if(d.All==0) return 1; return (d.All)} )
		 //    //     .style('fill', d3.scale.category20());  //function(d){return d.Deaths}
		 //    .data(data).enter()
		 //    .insert('rect')
		 //        .attr("class", "area").attr("clip-path", "url(#clip)")
		 //        .attr('x', function(d){x=x+prev+pad; prev=parseInt(d.All); return x;})
		 //        // .attr('x', function(d){return xScale(d.x)})
		 //        .attr('width', function(d){if(d.All==0) return 1; return (d.All)})
		 //        .attr('height', function(d){if(d.All==0) return 1; return (d.All)} )
		 //        .style('fill', d3.scale.category20());  //function(d){return d.Deaths}



			// g.selectAll("circle")
			// .data(data).enter()
		 //    .insert('circle')
		 //    	.attr("class", "area").attr("clip-path", "url(#clip)")
		 //        .attr('r', function(d){if(d.All==0) return 1; return xScale(d.All)})
		 //        .attr('cx', function(d){cx=cx+cprev+pad; cprev=parseInt(d.All); return cx;})
		 //    	.attr('cy', 200)
		 //    	.style('fill', "red");

		     update = function(){
			    g.selectAll("rect")
			        .transition().duration(500)
					.attr("x", function(d){return lx+parseInt(d.rX)-10});

			    g.selectAll("#l1")
			        .transition().duration(500)
			        .attr("x1", function(d){return lx+parseInt(d.inx1)})
		    		.attr("x2", function(d){return lx+parseInt(d.inx2)})

			    g.selectAll("#l2")
			        .transition().duration(500)
			        .attr("x1", function(d){return lx+parseInt(d.outx1)})
		    		.attr("x2", function(d){return lx+parseInt(d.outx2)})

		    	g.selectAll("#cAll")
			        .transition().duration(500)
			        .attr("cx", function(d){return lx+parseInt(d.rX)+40});

			    g.selectAll("#cDeaths")
			        .transition().duration(500)
			        .attr("cx", function(d){return lx+parseInt(d.rX)+40});


				g.selectAll("#bar12All")
			        .transition().duration(500)
			        .attr("x", function(d){return lx+parseInt(d.rX);})

			    g.selectAll("#bar13All")
			        .transition().duration(500)
			        .attr("x", function(d){return lx+parseInt(d.rX)+22;})

			    g.selectAll("#bar14All")
			        .transition().duration(500)
			        .attr("x", function(d){return lx+parseInt(d.rX)+44;})

			    g.selectAll("#bar12Deaths")
			        .transition().duration(500)
			        .attr("x", function(d){return lx+parseInt(d.rX);})

			    g.selectAll("#bar13Deaths")
			        .transition().duration(500)
			        .attr("x", function(d){return lx+parseInt(d.rX)+22;})

			    g.selectAll("#bar14Deaths")
			        .transition().duration(500)
			        .attr("x", function(d){return lx+parseInt(d.rX)+44;})



			    g.selectAll("text")
			        .transition().duration(500)
			        .attr("x", function(d){return lx+parseInt(d.rX)});

			    g.selectAll("#gender1")
			        .transition().duration(500)
			        .attr("x", function(d){return lx+parseInt(d.rX)})

			    g.selectAll("#gender2")
			        .transition().duration(500)
			        .attr("x", function(d){
			        	m=parseInt(d.Male);
			    		f=parseInt(d.Female);
			    		if((m+f)>0){
			    			t = m/(m+f)*80;
			    		}else t=0;

			    		return lx+t+parseInt(d.rX);
			    	});

			     g.selectAll("#day")
			        .transition().duration(500)
			        .attr("x", function(d){return lx+parseInt(d.rX)})

			    g.selectAll("#night")
			        .transition().duration(500)
			        .attr("x", function(d){
				        m=parseInt(d.Day);
			    		f=parseInt(d.Night);
			    		if((m+f)>0){
			    			t = m/(m+f)*80;
			    		}else t=0;

			    		return lx+t+parseInt(d.rX);
		    		});

			    g.selectAll("#figures")
			        .transition().duration(500)
			        // .attr("x", function(d){return lx+parseInt(d.rX)+30+d.All/2})
			        // .attr("x", function(d){return lx+parseInt(d.rX)+parseInt(d.All)+10})
			        .attr("x", function(d){return lx+parseInt(d.rX)+60})
		    	

			    g.selectAll("#figuresdeaths")
			        .transition().duration(500)
		    		// .attr("x", function(d){return lx+parseInt(d.rX)+d.All/2+30})
		    		.attr("x", function(d){return lx+parseInt(d.rX)+70;})

		    	g.selectAll("#bar12AText")
			    .transition().duration(500)
	    		.attr("x", function (d){return lx+parseInt(d.rX)+1;})

	    		g.selectAll("#bar13AText")
			    .transition().duration(500)
	    		.attr("x", function (d){return lx+parseInt(d.rX)+22+1;})

	    		g.selectAll("#bar14AText")
			    .transition().duration(500)
	    		.attr("x", function (d){return lx+parseInt(d.rX)+44+1;})

	    		g.selectAll("#bar12DText")
			    .transition().duration(500)
	    		.attr("x", function (d){return lx+parseInt(d.rX)+1;})

	    		g.selectAll("#bar13DText")
			    .transition().duration(500)
	    		.attr("x", function (d){return lx+parseInt(d.rX)+22+1;})

	    		g.selectAll("#bar14DText")
			    .transition().duration(500)
	    		.attr("x", function (d){return lx+parseInt(d.rX)+44+1;})

	    		g.selectAll("#maleicon")
	    		.transition().duration(500)
			    .attr("x", function(d){return lx+parseInt(d.rX)-20;})

	    		g.selectAll("#femaleicon")
	    		.transition().duration(500)
			    .attr("x", function(d){return lx+parseInt(d.rX)+85;})

			    g.selectAll("#dayicon")
	    		.transition().duration(500)
			    .attr("x", function(d){return lx+parseInt(d.rX)-20;})

	    		g.selectAll("#nighticon")
	    		.transition().duration(500)
			    .attr("x", function(d){return lx+parseInt(d.rX)+85;})

			    g.selectAll("#stationsymbol")
	    		.transition().duration(500)
			    .attr("x", function(d){return lx+parseInt(d.rX);})
			    
			     g.selectAll("#stations")
	    		.transition().duration(500)
			    .attr("x", function(d){return lx+parseInt(d.rX)+20;})
			};		
	});
	}
	
	var year=2014;

	

	function updateData(n){
		console.log(n)
		
		var d1;
		if(n==0){
			year=document.getElementById('years');
			d1=year[year.selectedIndex].value;
		}
		else
		if(n==1){
			year=document.getElementById('years2');
			d1=year[year.selectedIndex].value;
		}
		else
		if(n==3){
			d1=year;
		}
		else
		if(n=="All"){
			d1="2012to2014"
		}
		else{
			d1 = n;
		}
		year=d1;
		var snippet = document.getElementById('snippet')
		snippet.innerHTML = year;
		// Effect.Shake('snippet')
		datasource = "data/"+d1+"Trains.csv";
		console.log(datasource);
		Effect.DropOut('finalmenu');
		// Effect.DropOut('selyears');

		var whichPage = page;
		console.log("?"+whichPage);

		// lx=0;
		// lx=-page*1100+1100;
		// lx = lx+speed*page;
		// page=1;

		if(n==0)
			run=false;
		else
			run=false;
		if(run)
			drawTheSvg();
		else
		{
			d3.csv([datasource], function(error, data){
				svg = d3.select('#chart');		


			g = svg.select("g");

			

			    g.selectAll("#l1")
			.data(data).enter();
			g.selectAll("#l1")
				.transition().duration(500)
				.attr("x1", function(d){return lx+parseInt(d.inx1)})
		    	.attr("y1", function(d){return d.iny1})
		    	.attr("x2", function(d){return lx+parseInt(d.inx2)})
		    	.attr("y2", function(d){return d.iny2})
		    	.attr("stroke",function(d){if(d.Line=="CR") return "lightblue"; else return "pink";})
		    	.attr("fill", "none")
		    	.attr("stroke-width", "6")
		    	.attr("stroke-opacity","0.7");
	    	 //   	.attr("x1", function(d){return lx+parseInt(d.inx1)})
		    	// .attr("y1", function(d){return d.iny1})
		    	// .attr("x2", function(d){return lx+parseInt(d.inx2)})
		    	// .attr("y2", function(d){return d.iny2})
		    	// .attr("stroke",function(d){if(d.Line=="CR") return "lightblue"; else return "pink";})
		    	// .attr("fill", "none")
		    	// .attr("stroke-width", "6")
		    	// .attr("stroke-opacity","0.7")
		    	// .style("stroke-dasharray", ("2,4,2,4,2,4"));


			g.selectAll("#stationsrect")
			.data(data).enter();
			g.selectAll("#stationsrect")
				.transition().duration(500)
				.attr("width","120")
		    	.attr("height", "20")
		    	.attr("rx", 6)
				.attr("ry", 6)
		    	.attr("x", function(d){ return lx+parseInt(d.rX)-10})
				.attr("y", function(d){return parseInt(d.rY)})
				.attr("fill", function(d){
					if(d.Type=="Interchange") return "#8AB66D";
					if(d.Type=="Slow") return "#99A6B0";
					if(d.Type=="Fast") return "#BC5C3D";
				})
				
		 

		    g.selectAll("#l2")
			.data(data).enter();
		    g.selectAll("#l2")
		    	.attr("x1", function(d){return lx+parseInt(d.outx1)})
		    	.attr("y1", function(d){return d.outy1})
		    	.attr("x2", function(d){return lx+parseInt(d.outx2)})
		    	.attr("y2", function(d){return d.outy2})
		    	.attr("stroke",function(d){
		    		return "lightgrey";
		    		// if(d.Line=="CR") return "lightblue"; else return "pink";
		    	})
		    	.attr("fill", "none")
		    	.attr("stroke-width", "6")
		    	.attr("stroke-opacity","0.7")
		    	// .style("stroke-dasharray", ("2,4,2,4,2,4"))
		    ;
		    

		    g.selectAll("#cAll")
			.data(data).enter();
			g.selectAll("#cAll")
		        .transition().duration(500)
		    	.attr("cx", function(d){
		    		return lx+parseInt(d.rX)+40;
		    	})
		    	.attr("cy", function(d){
		    		if(d.Line == "CR")
		    			return parseInt(d.rY)-d.All/2-40-10;
		    		else
		    			return parseInt(d.rY)+d.All/2+40+30;
		    	})	
		    	// .attr("r", function(d){
		    	// 	if(d.All==0) return 1; 
		    	// 	return d.All/2;
		    	// })
		    	.attr("r", function(d){
		    		if(year=="2012to2014"){
		    			console.log("showbars3")
		    			return 0;
		    		}
		    		else
		    		{
			    		if(showDeathsOnly){
			    			return 0;
			    		}
			    		if(d.All==0) 
			    			return 1; 
			    		else
			    			return d.All/2;
		    		}
		    	})
		    	.attr("fill", "lightblue")
		    	.attr("fill-opacity","0.8")
		    ;
		    	
		    	
			    	
			    	

		    g.selectAll("#cDeaths")
			.data(data).enter();
		    g.selectAll("#cDeaths")
		        .transition().duration(500)
		    	.attr("cx", function(d){return lx+parseInt(d.rX)+40})
		    	
		    	.attr("cy", function(d){
		    		if(!showDeathsOnly){
		    			if(d.Line == "CR"){
			    			yy = parseInt(d.rY)-d.Deaths/2-40-10
			    			console.log(yy)
			    			return yy;
			    		}
			    		else{
			    			yy = parseInt(d.rY)+d.Deaths/2+40+30;
			    			console.log("w: "+yy)
			    			return yy;
			    		}
		    		}
		    		else
		    		{
			    		if(d.Line == "CR"){
			    			return parseInt(d.rY)-(d.Deaths*2)-40-10;
			    		}
			    		else{
			    			return parseInt(d.rY)+(d.Deaths*2)+40+30;
			    		}
		    		}
		    	})
		    	.attr("r", function(d){
		    		if(year=="2012to2014"){
		    			return 0;
		    		}
		    		else
		    		{
			    		if(d.All==0) 
			    			return 1; 
			    		if(showDeathsOnly){
			    			return d.Deaths*2;
			    		}
			    		return d.Deaths/2;
			    	}
		    	})
		    	.attr("fill", "darkred")
		    	.attr("fill-opacity","0.8")
		    ;
		


			g.selectAll("#bar12All")
				.data(data).enter();
			g.selectAll("#bar12All")
		        .transition().duration(500)
		    	.attr("width", 20) 
		    	.attr("height", function(d){
		    		if(year=="2012to2014" && !showDeathsOnly){
		    			yScale.domain([0, d3.max(data, function(d) { return d.All12; })]);
			    		return yScale(d.All12);
			    	}
		    		return 0;
		    	})
		    	.attr("x", function(d){return lx+parseInt(d.rX);})
				.attr("y", function (d) {
					// return yScale(d.All12);
					if(year=="2012to2014"){
		            	if(d.Line=="CR")
			    			return parseInt(d.rY)-35-yScale(d.All12);
			    		else
			    			return parseInt(d.rY)+45;	
	    			}		    			
	            })
				.attr("fill", "#FFCC00")
		    	.attr("fill-opacity","0.6")
			;

			g.selectAll("#bar12Deaths")
				.data(data).enter();
			g.selectAll("#bar12Deaths")
		        .transition().duration(500)
		    	.attr("width", 20) 
		    	.attr("height", function(d){
		    		if(year=="2012to2014" && !showDeathsOnly){
		    			yScale.domain([0, d3.max(data, function(d) { return d.All12; })]);
			    		return yScale(d.Deaths12);
			    	}
			    	if(year=="2012to2014" && showDeathsOnly){
		    			dScale.domain([0, d3.max(data, function(d) { return d.Deaths12; })]);
			    		return dScale(d.Deaths12);
			    	}
		    		return 0;
		    	})
		    	.attr("x", function(d){return lx+parseInt(d.rX);})
				.attr("y", function (d) {
					if(year=="2012to2014"){
						if(d.Line=="CR"){
							if(!showDeathsOnly)
			    				return parseInt(d.rY)-35-yScale(d.Deaths12);
			    			else
			    				return parseInt(d.rY)-35-dScale(d.Deaths12)
			    		}
			    		else
			    			return parseInt(d.rY)+45;		    			
			    	}
	            })
				.attr("fill", "darkred")
		    	.attr("fill-opacity","0.6")
			;

			g.selectAll("#bar13All")
				.data(data).enter();
			g.selectAll("#bar13All")
		        .transition().duration(500)
		    	.attr("width", 20) 
		    	.attr("height", function(d){
		    		if(year=="2012to2014" && !showDeathsOnly){
		    			yScale.domain([0, d3.max(data, function(d) { return d.All13; })]);
			    		return yScale(d.All13);
			    	}
		    		return 0;
		    	})
		    	.attr("x", function(d){return lx+parseInt(d.rX)+22;})
				.attr("y", function (d) {
					if(year=="2012to2014"){
		            	if(d.Line=="CR")
			    			return parseInt(d.rY)-35-yScale(d.All13);
			    		else
			    			return parseInt(d.rY)+45;		
			    	}    			
	            })
				.attr("fill", "#FFCC00")
		    	.attr("fill-opacity","0.6")
			;

			g.selectAll("#bar13Deaths")
				.data(data).enter();
			g.selectAll("#bar13Deaths")
		        .transition().duration(500)
		    	.attr("width", 20) 
		    	.attr("height", function(d){
		    		if(year=="2012to2014" && !showDeathsOnly){
		    			yScale.domain([0, d3.max(data, function(d) { return d.All13; })]);
			    		return yScale(d.Deaths13);
			    	}
			    	if(year=="2012to2014" && showDeathsOnly){
		    			dScale.domain([0, d3.max(data, function(d) { return d.Deaths13; })]);
			    		return dScale(d.Deaths13);
			    	}
		    		return 0;
		    	})
		    	.attr("x", function(d){return lx+parseInt(d.rX)+22;})
				.attr("y", function (d) {
					if(year=="2012to2014"){
		            	if(d.Line=="CR")
		            	{
		            		if(!showDeathsOnly)
			    				return parseInt(d.rY)-35-yScale(d.Deaths13);
			    			else
			    				return parseInt(d.rY)-35-dScale(d.Deaths13);
			    		}
			    		else
			    			return parseInt(d.rY)+45;
			    	}		    			
	            })
				.attr("fill", "darkred")
		    	.attr("fill-opacity","0.6")
			;

			g.selectAll("#bar14All")
				.data(data).enter();
			g.selectAll("#bar14All")
		        .transition().duration(500)
		    	.attr("width", 20) 
		    	.attr("height", function(d){
		    		if(year=="2012to2014" && !showDeathsOnly){
		    			yScale.domain([0, d3.max(data, function(d) { return d.All14; })]);
			    		return yScale(d.All14);
			    	}
		    		return 0;
		    	})
		    	.attr("x", function(d){return lx+parseInt(d.rX)+44;})
				.attr("y", function (d) {
					if(year=="2012to2014"){
		            	if(d.Line=="CR")
			    			return parseInt(d.rY)-35-yScale(d.All14);
			    		else
			    			return parseInt(d.rY)+45;
			    	}		    			
	            })
				.attr("fill", "#FFCC00")
		    	.attr("fill-opacity","0.6")
			;

			g.selectAll("#bar14Deaths")
				.data(data).enter();
			g.selectAll("#bar14Deaths")
		        .transition().duration(500)
		    	.attr("width", 20) 
		    	.attr("height", function(d){
		    		if(year=="2012to2014" && !showDeathsOnly){
		    			yScale.domain([0, d3.max(data, function(d) { return d.All14; })]);
			    		return yScale(d.Deaths14);
			    	}
			    	if(year=="2012to2014" && showDeathsOnly){
		    			dScale.domain([0, d3.max(data, function(d) { return d.Deaths14; })]);
			    		return dScale(d.Deaths14);
			    	}
	    			return 0;
		    	})
		    	.attr("x", function(d){return lx+parseInt(d.rX)+44;})
				.attr("y", function (d) {
					if(year=="2012to2014"){
		            	if(d.Line=="CR"){
		            		if(!showDeathsOnly)
		            			return parseInt(d.rY)-35-yScale(d.Deaths14);
		            		else
		            			return parseInt(d.rY)-35-dScale(d.Deaths14);
			    		}
			    		else
			    			return parseInt(d.rY)+45;
			    	}		    			
	            })
				.attr("fill", "darkred")
		    	.attr("fill-opacity","0.6")
			;

			g.selectAll("#gender1")
			.data(data).enter();
			g.selectAll("#gender1")
		        .transition().duration(500)
		    	.attr("width", function(d){
		    		if(year=="2012to2014"){
		    			return 0;
		    		}
		    		else
		    		{
			    		m=parseInt(d.Male);
			    		f=parseInt(d.Female);
			    		if((m+f)>0){
			    			t = m/(m+f)*80;
			    		}else t=0;
			    		t = Math.round(t);
			    		// console.log("M:"+t)
			    		return t;
			    	}
		    	})
		    	.attr("height", 10 )
		    	.attr("x", function(d){return lx+parseInt(d.rX);})
				.attr("y", function(d){if(d.Line=="CR")
		    			return parseInt(d.rY)-35;
		    		else
		    			return parseInt(d.rY)+45;
		    	})
				.attr("fill", "#31A2FD")
		    ;

		    g.selectAll("#gender2")
			.data(data).enter();
		    g.selectAll("#gender2")
		        .transition().duration(500)
		    	.attr("width", function(d){
		    		if(year=="2012to2014"){
		    			return 0;
		    		}
		    		else
		    		{
			    		m=parseInt(d.Male);
			    		f=parseInt(d.Female);
			    		if((m+f)>0){
			    			t = f/(m+f)*80;
			    		}else t=0;
			    		t = Math.round(t);
			    		// t2=10-t
			    		// console.log("F:"+t)
			    		return t;
			    	}
		    	})
		    	.attr("height", 10 )
		    	.attr("x", function(d){
		    		m=parseInt(d.Male);
		    		f=parseInt(d.Female);
		    		if((m+f)>0){
		    			t = m/(m+f)*80;
		    		}else t=0;

		    		return lx+t+parseInt(d.rX);
		    	})
				.attr("y", function(d){if(d.Line=="CR")
		    			return parseInt(d.rY)-35;
		    		else
		    			return parseInt(d.rY)+45;
		    	})
				.attr("fill", "#491B65")
		    ;

		    g.selectAll("#day")
			.data(data).enter();
		    g.selectAll("#day")
		        .transition().duration(500)
		    	.attr("width", function(d){
		    		if(year=="2012to2014"){
		    			return 0;
		    		}
		    		else
		    		{
			    		m=parseInt(d.Day);
			    		f=parseInt(d.Night);
			    		if((m+f)>0){
			    			t = m/(m+f)*80;
			    		}else t=0;
			    		t = Math.round(t);
			    		// t2=10-t
			    		// console.log("F:"+t)
			    		return t;
			    	}
		    	})
		    	.attr("height", 10 )
		    	.attr("x", function(d){return lx+parseInt(d.rX);})
				.attr("y", function(d){if(d.Line=="CR")
		    			return parseInt(d.rY)-20;
		    		else
		    			return parseInt(d.rY)+30;
		    	})
				// .attr("fill", "#CC9900")
				.attr("fill", "yellow")
				// .attr("stroke", "#666")
				// .attr("stroke-width","1")
		    ;

		    g.selectAll("#night")
			.data(data).enter();
		    g.selectAll("#night")
		        .transition().duration(500)
		    	.attr("width", function(d){
		    		if(year=="2012to2014"){
		    			return 0;
		    		}
		    		else
		    		{
			    		m=parseInt(d.Day);
			    		f=parseInt(d.Night);
			    		if((m+f)>0){
			    			t = f/(m+f)*80;
			    		}else t=0;
			    		t = Math.round(t);
			    		// t2=10-t
			    		// console.log("F:"+t)
			    		return t;
			    	}
		    	})
		    	.attr("height", 10 )
		    	.attr("x", function(d){
		    		m=parseInt(d.Day);
		    		f=parseInt(d.Night);
		    		if((m+f)>0){
		    			t = m/(m+f)*80;
		    		}else t=0;

		    		return lx+t+parseInt(d.rX);
		    	})
				.attr("y", function(d){if(d.Line=="CR")
		    			return parseInt(d.rY)-20;
		    		else
		    			return parseInt(d.rY)+30;
		    	})
				// .attr("fill", "#AEAEAE")
				.attr("fill", "#666")
				// .attr("stroke", "#666")
				// .attr("stroke-width","1")
		    ;

		    g.selectAll("#stationsymbol")
			.data(data).enter();
			g.selectAll("#stations")
		        .transition().duration(500)
		    	.attr("x", function(d){return lx+parseInt(d.rX)})
		    	.attr("y", function(d){return parseInt(d.rY)+3})
		    	;

		    g.selectAll("#stations")
			.data(data).enter();
			g.selectAll("#stations")
		        .transition().duration(500)
		    	.attr("x", function(d){return lx+parseInt(d.rX)+20})
		    	.attr("y", function(d){return parseInt(d.rY)+15})
		    	.text(function (d) {return d.Station;})
		    	.attr("font-family", "sans-serif")
	            .attr("font-size", "11px")
	            .attr("fill", "white");
		    	;

		    g.selectAll("#figures")
			.data(data).enter();
		   	g.selectAll("#figures")
		        .transition().duration(500)
		        .attr("x", function(d){return lx+parseInt(d.rX)+60})
		    	// .attr("x", function(d){return lx+parseInt(d.rX)+30+d.All/2})
		    	// .attr("y", function(d){return lx+parseInt(d.rY)-d.All/2-25})
		    	// .attr("y", function(d){return lx+parseInt(d.rY)-d.All/2-25})
		    	.attr("y", function(d){
		    		if(d.Line=="CR")
		    			return parseInt(d.rY)-75;
	    			else
		    			return parseInt(d.rY)+115;
		    	})
		    	.text(function (d) {
		    		if(year=="2012to2014"){
		    			return "";
		    		}
		    		else
		    		{
			    		if(d.All==0){
			    			if(!showDeathsOnly){
			    				return "No accidents";
			    			}
			    			else return "";
			    		}
			    		else{
			    			if(!showDeathsOnly){
			    				return d.All;
			    			}
			    		}
		    		}
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", "Bold")
	            .attr("font-size", function (d) {
	            	if(d.All==0)
		    			return 10;
		    		else
		    	     	return 35;
	            })
	            .attr("fill", "grey")
	            .style("fill-opacity", "0.7")
	        ;

	        g.selectAll("#figuresdeaths")
			.data(data).enter();
		   	g.selectAll("#figuresdeaths")
		        .transition().duration(500)
		    	// .attr("x", function(d){return lx+parseInt(d.rX)+d.All/2+30})
		    	// .attr("y", function(d){return lx+parseInt(d.rY)-25})
		    	.attr("x", function(d){return lx+parseInt(d.rX)+70})
		    	.attr("y", function(d){
		    		if(d.Line=="CR")
		    			return parseInt(d.rY)-55;
	    			else
		    			return parseInt(d.rY)+85;
		    	})
		    	.text(function (d) {
		    		if(year=="2012to2014"){
		    			return "";
		    		}
		    		else
		    		{
			    		if(!showDeathsOnly){
			    			if(d.Deaths==0){
			    				return "";
				    		}
				    		else 
				    			return d.Deaths;
			    		}
			    		else{
			    			if(d.Deaths==0){
			    				return "No fatalities";
				    		}
				    		else 
				    			return d.Deaths;
			    		}
		    		}
		    		
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", function (d) {
		    		if(!showDeathsOnly){
		    			return "light";
		    		}
		    		else{
		    			if(d.Deaths==0)
		    				return "light";
		    			else
		    				return "bold";
		    		}
		    	})
	            .attr("font-size", function (d) {
	            	if(!showDeathsOnly){
	            		return 10;
	            	}
	            	else{
	            		if(d.Deaths==0)
	            			return 12;
	            		return 25;
	            	}
	            })
	            .attr("fill", "darkred")
	            .style("fill-opacity", "0.7")
		    	;


		    	g.selectAll("#bar12AText")
				.data(data).enter();
			   	g.selectAll("#bar12AText")
		        .transition().duration(500)
		    	.attr("x", function (d){return lx+parseInt(d.rX)+1;})
				.attr("y", function (d) {
	    			yScale.domain([0, d3.max(data, function(d) { return d.All12; })]);
		    		var ht =  yScale(d.All12);
					if(year=="2012to2014"){
		            	if(d.Line=="CR")
			    			return parseInt(d.rY)-40-yScale(d.All12);
			    		else
			    			return parseInt(d.rY)+60+yScale(d.All12);
			    	}		    			
	            })	
		    	.text(function (d) {
		    		if(year!="2012to2014"){
		    			return "";
		    		}
		    		else
			    		{
			    		if(d.All12==0){
			    			if(!showDeathsOnly){
			    				return "0";
			    			}
			    			else return "";
			    		}
			    		else{
			    			if(!showDeathsOnly){
			    				return d.All12;
			    			}
			    		}
			    	}
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", "light")
	            .attr("font-size", 12)
	            .attr("fill", "grey")
	            .style("fill-opacity", "0.7")
		    	;

		    g.selectAll("#bar12DText")
				.data(data).enter();
			   	g.selectAll("#bar12DText")
		        .transition().duration(500)
		    	.attr("x", function (d){return lx+parseInt(d.rX)+1;})
				.attr("y", function (d) {
	    			dScale.domain([0, d3.max(data, function(d) { return d.Deaths12; })]);
		    		var ht =  dScale(d.Deaths12);
					if(year=="2012to2014"){
		            	if(d.Line=="CR"){
		            		if(showDeathsOnly)
			    				return parseInt(d.rY)-40-dScale(d.Deaths12);
			    			else
			    				return parseInt(d.rY)-40-yScale(d.Deaths12);
			    		}
			    		else{
			    			if(showDeathsOnly)
			    				return parseInt(d.rY)+60+dScale(d.Deaths12);
			    			else
			    				return parseInt(d.rY)+60+yScale(d.Deaths12);
			    		}
			    	}		    			
	            })	
		    	.text(function (d) {
		    		if(year!="2012to2014"){
		    			return "";
		    		}
		    		else
		    		{	
		    			return d.Deaths12;
			    	}
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", "light")
	            .attr("font-size", 12)
	            .attr("fill", "darkred")
	            .style("fill-opacity", "0.7")
		    	;



	    	g.selectAll("#bar13AText")
				.data(data).enter();
			   	g.selectAll("#bar13AText")
		        .transition().duration(500)
		    	.attr("x", function (d){return lx+parseInt(d.rX)+22+1;})
				.attr("y", function (d) {
					yScale.domain([0, d3.max(data, function(d) { return d.All13; })]);
		    		var ht =  yScale(d.All13);
					if(year=="2012to2014"){
		            	if(d.Line=="CR")
			    			return parseInt(d.rY)-40-yScale(d.All13);
			    		else
			    			return parseInt(d.rY)+60+yScale(d.All13);
			    	}		    			
	            })	
		    	.text(function (d) {
		    		if(year!="2012to2014"){
		    			return "";
		    		}
		    		else
			    		{
			    		if(d.All13==0){
			    			if(!showDeathsOnly){
			    				return "0";
			    			}
			    			else return "";
			    		}
			    		else{
			    			if(!showDeathsOnly){
			    				return d.All13;
			    			}
			    		}
			    	}
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", "light")
	            .attr("font-size", 12)
	            .attr("fill", "grey")
	            .style("fill-opacity", "0.7")
		    	;

		    g.selectAll("#bar13DText")
				.data(data).enter();
			   	g.selectAll("#bar13DText")
		        .transition().duration(500)
		    	.attr("x", function (d){return lx+parseInt(d.rX)+22+1;})
				.attr("y", function (d) {
	    			dScale.domain([0, d3.max(data, function(d) { return d.Deaths13; })]);
		    		var ht =  dScale(d.Deaths13);
					if(year=="2012to2014"){
		            	if(d.Line=="CR"){
		            		if(showDeathsOnly)
			    				return parseInt(d.rY)-40-dScale(d.Deaths13);
			    			else
			    				return parseInt(d.rY)-40-yScale(d.Deaths13);
			    		}
			    		else{
			    			if(showDeathsOnly)
			    				return parseInt(d.rY)+60+dScale(d.Deaths13);
			    			else
			    				return parseInt(d.rY)+60+yScale(d.Deaths13);
			    		}
			    	}		    			
	            })	
		    	.text(function (d) {
		    		if(year!="2012to2014"){
		    			return "";
		    		}
		    		else
		    		{	
		    			return d.Deaths13;
			    	}
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", "light")
	            .attr("font-size", 12)
	            .attr("fill", "darkred")
	            .style("fill-opacity", "0.7")
		    	;


			g.selectAll("#bar14AText")
				.data(data).enter();
			   	g.selectAll("#bar14AText")
		        .transition().duration(500)
		    	.attr("x", function (d){return lx+parseInt(d.rX)+44;})
				.attr("y", function (d) {
					yScale.domain([0, d3.max(data, function(d) { return d.All14; })]);
		    		var ht =  yScale(d.All14);
					if(year=="2012to2014"){
		            	if(d.Line=="CR")
			    			return parseInt(d.rY)-40-yScale(d.All14);
			    		else
			    			return parseInt(d.rY)+60+yScale(d.All14);
			    	}		    			
	            })	
		    	.text(function (d) {
		    		if(year!="2012to2014"){
		    			return "";
		    		}
		    		else
			    		{
			    		if(d.All14==0){
			    			if(!showDeathsOnly){
			    				return "0";
			    			}
			    			else return "";
			    		}
			    		else{
			    			if(!showDeathsOnly){
			    				return d.All14;
			    			}
			    		}
			    	}
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", "light")
	            .attr("font-size", 12)
	            .attr("fill", "grey")
	            .style("fill-opacity", "0.7")
		    	;

		    g.selectAll("#bar14DText")
				.data(data).enter();
			   	g.selectAll("#bar14DText")
		        .transition().duration(500)
		    	.attr("x", function (d){return lx+parseInt(d.rX)+44+1;})
				.attr("y", function (d) {
	    			dScale.domain([0, d3.max(data, function(d) { return d.Deaths14; })]);
		    		var ht =  dScale(d.Deaths14);
					if(year=="2012to2014"){
		            	if(d.Line=="CR"){
		            		if(showDeathsOnly)
			    				return parseInt(d.rY)-40-dScale(d.Deaths14);
			    			else
			    				return parseInt(d.rY)-40-yScale(d.Deaths14);
			    		}
			    		else{
			    			if(showDeathsOnly)
			    				return parseInt(d.rY)+60+dScale(d.Deaths14);
			    			else
			    				return parseInt(d.rY)+60+yScale(d.Deaths14);
			    		}
			    	}		    			
	            })	
		    	.text(function (d) {
		    		if(year!="2012to2014"){
		    			return "";
		    		}
		    		else
		    		{	
		    			return d.Deaths14;
			    	}
		    	})
		    	.attr("font-family", "Open Sans")
		    	.attr("font-weight", "light")
	            .attr("font-size", 12)
	            .attr("fill", "darkred")
	            .style("fill-opacity", "0.7")
		    	;


		    g.selectAll("#maleicon")
				.data(data).enter();
			   	g.selectAll("#maleicon")
		        .transition().duration(500)
	            .attr("xlink:href", "images/male.svg")
                .attr("x", function(d){return lx+parseInt(d.rX)-20;})
				.attr("y", function(d){
					// return 100;
					if(d.Line=="CR")
		    			return parseInt(d.rY)-35-8;
		    		else
		    			return parseInt(d.rY)+35+8;
		    	})
		    	.attr("width",function(d){
		    		if(parseInt(d.Male)+parseInt(d.Female)<=0 || year=="2012to2014") { return 0;}
		    		return 15
		    	})
		    	.attr("height",function(d){
		    		if(parseInt(d.Male)+parseInt(d.Female)<=0 || year=="2012to2014") { return 0;}
		    		return 15
		    	})
		    	;

             g.selectAll("#femaleicon")
				.data(data).enter();
			   	g.selectAll("#femaleicon")
                .attr("id","femaleicon")
                .attr("xlink:href", "images/female.svg")
                .attr("x", function(d){return lx+parseInt(d.rX)+85;})
				.attr("y", function(d){
					// return 100;
					if(d.Line=="CR")
		    			return parseInt(d.rY)-35-8;
		    		else
		    			return parseInt(d.rY)+35+8;
		    	})
		    	.attr("width",function(d){
		    		if(parseInt(d.Male)+parseInt(d.Female)<=0 || year=="2012to2014") { return 0;}
		    		return 15
		    	})
		    	.attr("height",function(d){
		    		if(parseInt(d.Male)+parseInt(d.Female)<=0 || year=="2012to2014") { return 0;}
		    		return 15
		    	})
                ;


             g.selectAll("#dayicon")
				.data(data).enter();
			   	g.selectAll("#dayicon")
                .attr("id","dayicon")
                .attr("xlink:href", "images/sun.svg")
                .attr("x", function(d){return lx+parseInt(d.rX)-20;})
				.attr("y", function(d){
					if(d.Line=="CR")
		    			return parseInt(d.rY)-35+10;
		    		else
		    			return parseInt(d.rY)+35-10;
		    	})
		    	.attr("width",function(d){
		    		if(parseInt(d.Day)+parseInt(d.Night)<=0  || year=="2012to2014") { return 0;}
		    		return 15
		    	})
		    	.attr("height",function(d){
		    		if(parseInt(d.Day)+parseInt(d.Night)<=0  || year=="2012to2014") { return 0;}
		    		return 15
		    	})
		    	;

             g.selectAll("#nighticon")
				.data(data).enter();
			   	g.selectAll("#nighticon")
                .attr("id","nighticon")
                .attr("xlink:href", "images/moon.svg")
                .attr("x", function(d){return lx+parseInt(d.rX)+85;})
				.attr("y", function(d){if(d.Line=="CR")
		    			return parseInt(d.rY)-35+10;
		    		else
		    			return parseInt(d.rY)+35-10;
		    	})
		    	.attr("width",function(d){
		    		if(parseInt(d.Day)+parseInt(d.Night)<=0  || year=="2012to2014") { return 0;}
		    		return 15
		    	})
		    	.attr("height",function(d){
		    		if(parseInt(d.Day)+parseInt(d.Night)<=0  || year=="2012to2014") {return 0;}
		    		return 15
		    	});





			});
			
			
		}

		// update();
	}


	var page=1;

	function moveLeft(){
		Effect.Appear('snippet', {duration: 0.8} );

		
		// Effect.Fade('popme');
		// popped = false;	
		
		page = (page-1);
		if(page<1) page=1;
		console.log(page);
		if(page==1){
			console.log(page);
			// Effect.Appear('selyears');
		}
		if(page==pages-1)
			Effect.DropOut('finalmenu');

		if(x>=0) {
	    		l=0;
	    		lx=0;
	    		cx=0;
	    		showLogo();
	    		Effect.Shake('chart',{duration:0.1, distance:5}); 
	    		return;
	    	}
    	hideLogo();
    	l=l+speed;
		x=l;
		lx = lx+speed;
		cx=l;
		// console.log("L:"+x);
		if(x>=0) {
    		l=0;
    		lx=0;
    		cx=0;
    		showLogo();
	    }

	    if(!legendHidden){toggleLegend();}
		update();
	}

	function moveRight(){
			Effect.Appear('snippet', {duration: 0.8} );

			// Effect.Fade('popme');
			// popped = false;	

			page = (page+1);
			if(page>=pages)
				page = pages;
			if(page==pages){
				Effect.Appear('finalmenu');
				Effect.Appear('selyears');
				Effect.Appear('bgformenu');
			}
			console.log(page);

			if(page>1){
				// Effect.DropOut('selyears');
			}

			if(x<=-(pages-1)*speed) {
				Effect.Shake('chart',{duration:0.1, distance:5}); 
				
				return;}

	       	hideLogo();
	       	l=l-speed;
			x=l;
			lx = lx-speed;

			if(x<=-pages*speed) {x=-pages*speed; l=-pages*speed;}

			cx=l;
			if(cx<=-pages*speed) {x=-pages*speed; l=-pages*speed;}

			// console.log("R:"+x)
			if(!legendHidden){toggleLegend();}
		    update();
	}

	var checkKey = function(e){
		// console.log(e);
	    if (e.keyCode == '38') {
	        // up arrow
	    }
	    else if (e.keyCode == '40') {
	        // down arrow
	    }
	    else if (e.keyCode == '37') {
	    	// left arrow
	    	// console.log("L:"+x)
	    	moveLeft()
	    }
	    else if (e.keyCode == '39') {
	       	// right arrow
	       	// console.log("R:"+x)
	       moveRight();
	    }



	}


//http://bl.ocks.org/mbostock/c501f6cae402ab5e90c9
	

	var width = 500,
	    height = 300,
	    radius = height / 2 - 10;

	var arc = d3.svg.arc()
	    .innerRadius(radius - 20)
	    .outerRadius(radius)
	    .cornerRadius(20);

	var pie = d3.layout.pie()
	    .padAngle(.02);

	var color = d3.scale.category10();

	var svg = d3.select('#chart2').append('svg')
	// var svg = d3.select("body").append("svg")
	    .attr("width", width)
	    .attr("height", height)
	  .append("g")
	    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

	svg.selectAll("path")
	    .data(pie(gender))
	  .enter().append("path")
	    .style("fill", function(d, i) { return color(i); })
	    .attr("d", arc);

	updatePie = function(){
		console.log(gender[0] + "," +gender[1])
		svg.selectAll("path")
			.data(pie(gender))
			// .enter().append("path")
		    .style("fill", function(d, i) { return color(i); })
		    .attr("d", arc)
		    .transition().duration(1000);
	}

	</script>


<div id="chart2" style="display:none"></div>


<div id="snippet" style="position: absolute; top:408px; left:560px; padding:5px; display: block; color: #99A6B0; font-weight:bold; font-size:20px">2014</div>

<div id="snippet2" style="position: absolute; top:508px; left:560px; padding:5px;  color:#99A6B0; font-weight: 800; font-size:20px">Click on the train at Thane to travel the railway...</div>

<!-- <div id="popme" style="position: absolute; top:408px; left:260px; padding:5px; display: block; color: gold; font-weight:bold; font-size:20px;background-image: url(images/bg.jpg)"><span id="stationName"></span></div>
 -->






<!-- <div id="selyears" style="position: absolute; top:15px; left:870px; font-size:small;">
<a href="#" onclick="updateData('2014')">2014</a>
 | <a href="#" onclick="updateData('2013')">2013</a>
 | <a href="#" onclick="updateData('2012')">2012</a> 
 | <a href="#" onclick="updateData('All')">Compare all years</a>
 <input type="checkbox" id='deathsonly' onClick="showDeaths()">Show only deaths</input><br/>			
 </div> -->

<div id="bgformenu" style="position: absolute; top:-50px; left:750px; display: none" >
	<svg width=490 height=130>
			<rect x="0" y="0" width="490" height="130" rx="10" ry="10" fill="yellow"/>
	</svg>
</div>
<div id="selyears" style="position: absolute; top:15px; left:770px; font-size:small; display: none">
	<table>
		<tr>
			<td valign="top">
				<a href="#" onclick="updateData('2014')"><strong>2014</strong></a>
				 | <a href="#" onclick="updateData('2013')"><strong>2013</strong></a>
				 | <a href="#" onclick="updateData('2012')"><strong>2012</strong></a> 
				 &nbsp;
				 <select name="earlier">
				 	<option>Earlier</option>
				 	<option>2011</option><option>2010</option><option>2009</option><option>2008</option>
				 	<option>2007</option><option>2006</option><option>2005</option><option>2005</option>
				 	<option>2004</option><option>2003</option><option>2002</option><option>2001</option>
				 	<option>2000</option><option>1999</option><option>1998</option><option>1997</option>
				 </select>
				 <br/><a href="#" onclick="updateData('All')">Compare all years</a><br/>
				 <input type="checkbox" id='deathsonly' onClick="showDeaths()"/> &nbsp; Show only deaths<br/>
			</td>
			<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
			<td valign="top">Select range:<br/>
				From date: <input type="text" id="datepicker1" size="10"><br/>
				To date:  &nbsp;&nbsp;&nbsp; <input type="text" id="datepicker2" size="10">
			</td>
			<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
			<td valign="top">Select specific stations:<br/>
				<select name="stations">
				 	<option>All</option><option>Thane</option><option>Mulund</option><option>Nahur</option>
				 	<option>Bhandup</option><option>Kanjurmarg</option><option>Vikhroli</option><option>Ghatkopar</option>
				 	<option>Vidhyavihar</option><option>Kurla</option><option>Sion</option><option>Matung</option>
				 	<option>Dadar C</option><option>Parel</option><option>Currey Road</option><option>Chinchpokli</option>
				 	<option>Byculla</option><option>Sandhurst Road</option><option>Masjid</option><option>CST Mumbai</option>
				 	<option>Andheri</option><option>Vile Parle</option><option>Santacruz</option><option>Khar</option>
				 	<option>Bandra</option><option>Mahim</option><option>Matunga Road</option><option>Dadar West</option>
				 	<option>Elphinstone Road</option><option>Lower Parel</option><option>Mahalaxmi</option><option>Mumbai Central</option><option>Grant Road</option><option>Charni Road</option><option>Marile Lines</option><option>Churchgate</option>
				 </select>
			</td>
		</tr>
	</table> 			
 </div>

<div class="btn-group" data-toggle="buttons" style="position: absolute; top:15px; left:770px; font-size:small;display: none">
	<label class="btn btn-default active">
		<input type="radio"  name="line" value="1"  autocomplete="off">2012</input>
	</label>
	<label class="btn btn-default">
		<input type="radio" name="line" value="2"  autocomplete="off">2013</input>
	</label>
	<label class="btn btn-default">
	<input type="radio"  name="line" value="3" autocomplete="off">2014</input>
	</label>
	<label class="btn btn-default">
	<ul class="dropdown-menu" role="menu">
      <li><a href="#">Dropdown link</a></li>
      <li><a href="#">Dropdown link</a></li>
    </ul>
</label>
</div>

<div id="finalmenu" style="position: absolute; top:250px; left:900px; display: none">
 <!-- <a href="#">View full map</a> -->
 <br/><br/>
 Take a journey again for year 
 <select id="years2" onchange="updateData('1'); skipToStart(); ">
	<option value="2014">2014</option>
	<option value="2013">2013</option>
	<option value="2012">2012</option>
</select>
<br/>
<a href="home.html">Explore further</a><br/><br/>
<a href="home.html"><img src="images/logo.png" width="60px" style="position: relative; top:-10px;"/></a>
</div>

<div id="stationlegend" style="position: absolute; top:480px; left:80px; font-size:x-small;">
	<svg width=200 height=150>
		<g>
			<rect x="0" y="0" width="110" height="20" rx="6" ry="6" fill="#8AB66D"/>
			<text x="5" y="14" fill="#FFF">Interchange Station</text>
		</g>
		<g>
			<rect x="0" y="25" width="110" height="20" rx="6" ry="6" fill="#99A6B0"/>
			<text x="5" y="39" fill="#FFF">Slow Station</text>
		</g>
		<g>
			<rect x="0" y="50" width="110" height="20" rx="6" ry="6" fill="#BC5C3D"/>
			<text x="5" y="64" fill="#FFF">Fast Station</text>
		</g>
		<g>
			<line x1=0 y1=81 x2=40 y2=81 stroke="lightblue" stroke-width=6 stroke-opacity="0.7"/>
			<text x="45" y="84" fill="grey">Central Railway Line</a>
		</g>
		<g>
			<line x1=0 y1=96 x2=40 y2=96 stroke="pink" stroke-width=6 stroke-opacity="0.7"/>
			<text x="45" y="99" fill="grey">Western Railway Line</a>
		</g>
		<g>
			<line x1=0 y1=111 x2=40 y2=111 stroke="grey" stroke-width=6 stroke-opacity="0.7"/>
			<text x="45" y="114" fill="grey">Harbour Railway Line (other)</a>
		</g>
	</svg>
</div>

<div id="startskip" style="position: absolute; top:610px; left:80px; font-size:x-small;">
	<a  id="showhidelegend" href="#" onClick="toggleLegend()" style="background-color: pink">Show legend</a> | 
	<a href="#" onclick="skipToStart()">back to start</a> | <a href="#" onclick="skip()">skip to end</a> | <a href="#" onClick="showTrain()">train demo</a> | <a href="home.html">Explore more data</a>
</div>

<div id="popme" style="position: absolute; top:100px; left:100px; border:0.5px solid lightgrey; box-shadow: 2px 2px 0px lightgrey; background-color: #FFF; padding:60px; display: none;background-image: url(images/bg.jpg)">
	
	<span id="stationName" style="font-weight:bold"></span><br/>
	<span style="position: relative; top:-70px; left:770px;font-size: 10px" onClick="hidePopup()">
		<a href="#">Close</a></span><br/>
	<a href="#">Highlight holidays</a> <br/>
	
	<br/>Monthly:<div id="monthly"><span style="font-size: 10px">
		</div>	

	<br/>Monthly Totals: <div id="monthlytotal"></div>

	<br/>Weekly Totals: <div id="weeklytotal">
	<table style="color:#444"> <tr align="center">
			<td style="background-color: darkred" width="20px", height="20p" > M </td>
			<td style="background-color: darkred" width="20px", height="20p"> T </td>
			<td style="background-color: darkred" width="20px", height="20p"> W </td>
			<td style="background-color: red"	  width="20px", height="20p"> T </td>
			<td style="background-color: pink"    width="20px", height="20p"> F </td>
			<td style="background-color: red"     width="20px", height="20p"> S </td>
			<td style="background-color: pink"    width="20px", height="20p"> S </td>
		</tr></table>
	</div>
	<span style="position: relative; top:50px; left:760px;font-size: 10px">
		<a href="#">Next station &gt;&gt;</a></span><br/>

	<span style="position: relative; top:30px; left:-40px;font-size: 10px">
		<a href="#">&lt;&lt; Previous station</a></span><br/>

	
</div>


<script>
	var calendar = new CalHeatMap();
	var calendar2 = new CalHeatMap();
	var itemNameV = "incident";
	var verticalOrientationV = false;
	var startDates = [2012, 2013, 2014];
	var domainV = "month";
	var domainDynamicDimensionV = false;
	var domainGutterV = 0;
	var domainMarginV = 0;
	var subDomainV = "day";
	var domainLabelFormatV = "%b-%y"; 
	//subDomainTextFormat: "%d",
	var rangeV = 12;
	var leg = [0,1,2,4];
	// var leg = [80,120,150,170];
	var legendVerticalPositionV = "bottom";
	var legendOrientationV = "horizontal";
	var cellSizeV = 9;
	var dataV = "jsons/ThaneAll.json";
	var inited=false;
	function showCalendar(){
		if(!inited){
			calendar.init({
			itemSelector: "#monthlytotal",
			itemName: itemNameV,
			verticalOrientation: verticalOrientationV,
	    	data: dataV,
	    	start: new Date(year, 0),
	    	domain: domainV,
			domainLabelFormat: domainLabelFormatV,
			domainDynamicDimension: domainDynamicDimensionV,
			domainGutter: domainGutterV,
		    domainMargin: domainMarginV,
		   	subDomain: subDomainV,
	    	considerMissingDataAsZero: true,
	    	//rowLimit: 31,
			//subDomainTextFormat: "%d",
			// subDomainTitleFormat: {
			// 	filled:	"Whats is going on {name} to be {count} if {date} over {connector}",
			// 	empty: "nothing to declare on {date}"
			// },
			range: rangeV,
			legend: leg,
			legendVerticalPosition: legendVerticalPositionV,
			legendOrientation: legendOrientationV,
			legendCellSize: 12,
			legendMargin: [10,0,0000,0], //top,right
			cellSize: cellSizeV,
			// legendColors: {
			// 	empty: "green"
			// }
			});

			calendar2.init({
			itemSelector: "#monthly",
			itemName: itemNameV,
			verticalOrientation: verticalOrientationV,
	    	data: dataV,
	    	start: new Date(year, 0),
	    	domain: "year",
			// domainLabelFormat: domainLabelFormatV,
			domainDynamicDimension: domainDynamicDimensionV,
	    	subDomain: "month",
	    	considerMissingDataAsZero: true,
	    	range: 1,
			legend: [0,5,10,15,20,25],
			legendVerticalPosition: legendVerticalPositionV,
			legendOrientation: legendOrientationV,
			legendCellSize: 12,
			subDomainTextFormat: "%b",
			domainLabelFormat: "",
			legendMargin: [10,0,0,0], //top,right
			cellSize: 50,
			// legendColors: {
			// 	empty: "green"
			// }
			});

			inited=true;
		}else{
			calendar.update(dataV);
			calendar2.update(dataV);
		}
	
	}
	    

</script>

<html>